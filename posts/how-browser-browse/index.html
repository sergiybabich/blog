<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>Як браузер ходить інтернетом — Сергій Бабіч</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel=icon href=https://sergiybabich.github.io/favicon.ico><link rel=stylesheet href=/css/style.min.fb5d1282ef81826b431e78c8cb0de3c94f82b2a0d338e8ac55d15b4f155c3ea3.css><meta name=description content="Що відбувається, коли ви просите ваш браузер зайти на ваш улюблений сайт? Скільки кроків потрібно йому, аби дізнатися, куди саме потрібно сходити за сторінкою? Як сервер розуміє що ви від нього хочете? Відповіді на ці та інші запитання ви й дізнаєтесь у цій статті."><meta property="og:title" content="Як браузер ходить інтернетом"><meta property="og:type" content="website"><meta property="og:url" content="https://sergiybabich.github.io/posts/how-browser-browse/"><meta property="og:image" content="https://sergiybabich.github.io/images/userpic.jpg"><meta property="og:description" content="Що відбувається, коли ви просите ваш браузер зайти на ваш улюблений сайт? Скільки кроків потрібно йому, аби дізнатися, куди саме потрібно сходити за сторінкою? Як сервер розуміє що ви від нього хочете? Відповіді на ці та інші запитання ви й дізнаєтесь у цій статті."><meta name=twitter:card content="summary"><meta name=twitter:site content="@babichss"><meta name=twitter:creator content="@babichss"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&family=Montserrat:wght@800&family=Rubik:wght@400;500;800&display=swap" rel=stylesheet><link href=https://sergiybabich.github.io/override.css rel=stylesheet><script async src="https://www.googletagmanager.com/gtag/js?id=G-MVMXZSTYSD"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MVMXZSTYSD",{anonymize_ip:!1})}</script></head><body class='page frame page-blog-single'><main id=wrapper class=wrapper><header class=header><a class=header-logo href=https://sergiybabich.github.io/>На головну сторінку</a></header><div class=blog><div class=author><img width=30 class=author-image src=/images/userpic.jpg>
<span class=author-name></span>
<span class=author-divider></span>
<span class=author-date>May 29, 2022</span></div><div class=intro><h1>Як браузер ходить інтернетом<span class=dot>.</span></h1></div><div class=content><p>Чи знаєте ви, як до вашого браузера потрапляють фотки смаженої русні, коли ви заходите, наприклад, на (уявний) сайт <strong>rusnipyz.da</strong>? А цікаво? Тоді давайте розглянемо увесь процес під мікроскопом.</p><p>Почнемо з браузера. Так от, ваш браузер це не “інтернет”, як казав ваш викладача з інформатики 20 років тому, а, власне, оглядач, вікно до чудового світу вільного доступу до інформації та тупих людей. Браузер — це така спеціяльна програма, задача якої отримати звідкись html-файл, або ж html-документ, як секретно називаємо його ми, комп’ютерники, прочитати його, виконати усі інструкції, пережувати, перем’яти в чорній скриньці і видати вам картинку, яку ви бачите, коли “заходите на сайт”. І так, це реально одна здоровенна картинка. Як саме відбувається ця чорна магія, я розповім дещо іншим разом.</p><p>Тепер важливо зазначити, що інтернет як такий не послуговується читабельними іменами, коли мова іде про доступ до якогось ресурсу, користується так званими <strong>IP-адресами</strong>. IP-адреса розшифровується як адреса <strong>I</strong>nternet <strong>P</strong>rotocol і являє собою групу з чотирьох чисел від <code>0</code> до <code>255</code>, коли мова іде про IPv4, або ж групу з восьми чисел, записаних в шістнадцятковій системі, коли мова йде про IPv6. Саме такі адреси і використовуються всередині мережі для пошуку ресурсів.</p><pre tabindex=0><code>IPv4
192.0.0.1

IPv6
2001:0db8:85a3:0000:0000:8a2e:0370:7334
</code></pre><p>Не найзручніша форма запису для людини, еге ж? Саме тому, аби полегшити вам життя, коли ви шукаєте чергове відео Арестовича, були придумані так звані доменні імена — читабельні адреси, які людина може запам’ятати і навіть надрукувати по пам’яти. І от саме такі адреси ми і вводимо в рядочку введення адреси в браузері. Ще важливе зауваження — в цій статті я пояснюю спрощений процес, бо в сучасному вебі усе відбувається дещо складніше, бо ще є така штука як сек’юрність, тобто безпека з’єднання, але тема для окремої історії.</p><h2 id=довгий-шлях-до-бібліотеки>Довгий шлях до бібліотеки</h2><p>Отже, ви друкуєте в рядочку адреси завітні буковки <strong>rusnipyz.da</strong> та натискаєте <kbd>Enter</kbd>. Що далі? Далі браузер починає гру “не підкажете, як пройти в бібліотеку?” і домахується до всіх, кого може знайти на своєму шляху.</p><p>Починає він із себе. Кожен браузер зберігає на нетривалий час так званий кеш таблички DNS, в якій записані усі нещодавно відвідані вами сайти. Тож, якщо ви останнім часом уже дивилися в конкретному браузері на смажену русню, то він уже знатиме найкоротший шлях до цього сайту. А <strong>DNS</strong> — це <em>Domain Name System</em>, така собі телефонна книжка для інтернету, де записані усі доменні імена та відповідні їм IP.</p><p>Якщо ж він не має такого запису, то пошук відбудеться в кеші на рівні вашої операційної системи, вашого Windows, MacOS, Android чи ще там що стоїть на вашому пристрої. Звідки ж цей запис може з’явитися там, на думку браузера? Дуже просто, він сподівається, що ви вже ходили на цей сайт, але з іншого браузера на цьому ж пристрої.</p><p>Коли ж він не знайде цієї інформації і там, ваш браузер не впадатиме у відчай, а чекатиме, поки ваш комп’ютер піде з цим питанням уже до вашого роутера, тобто пристрою, що роздає інтернет на всі ваші пристрої. Цього разу розрахунок іде на те, що ви усе таки відвідували сайт, але з іншого пристрою в цій же мережі. Маленький сміливий браузер ніколи не здається!</p><p>І він не втратить надії, навіть якщо не знайдеться потрібної інформації і у роутера, бо тоді останній звернеться до вашого інтернет-провайдера, і попросить його пошукати у себе, в його DNS-таблицях, які уже незрівнянно більші за все, де пошук відбувався до того, адже в таких таблицях зберігаються відвідані сайти від тисяч користувачів.</p><p>Ну, а якщо невдача спіткає і тут, то сумний, але незламний браузер чекатиме, поки відбудеться пошук уже на великих DNS-серверах, поки таку адресу не знайдуть. Або не знайдуть. Якщо не знайдуть, то браузер покаже вам сумну сторінку, на якій писатиме шось по комп’ютерному на кшталт <code>DNS_PROBE_FINISHED_NXDOMAIN</code>. Щойно такий запис буде знайдено, кеш DNS оновиться на усіх рівнях, аби наш маленький, але такий в’їдливий браузер не турбував їх зайвий раз.</p><p>Отже, браузер отримав справжню IP-адресу сайту, і тепер він повинен зв’язатися із сервером, аби попросити його, нарешті, віддати йому те, що там лежить, бо вже несила ждати ті фотки смаженої русні, ну. Як він це робить? Якщо коротко, між ними відбувається приблизно такий діалог:</p><p>— Превіт!, — каже браузер.</p><p>— Шо там? — зайнято бурчить сервер.</p><p>— Діло є.</p><p>Якщо перекласти це на комп’терну, то відбувається наступне:</p><ol><li>Спочатку браузер відправляє серверу так званий <strong>SYN</strong>, <strong>Synchronize Sequence Number</strong>, той самий умовний “Превіт”, яким повідомляє, шо був би не проти почати спілкуватись.</li><li>Далі сервер, якщо він справний, не зайнятий і має час та натхення, відправляє у відповдь нашому браузеру пакет <del>з АТБ</del> даних, в якому лежить той самий SYN, збільшений на одиничку, та ще так званий <strong>ACK</strong> (від acknowledge), теж SYN, але від сервера.</li><li>Браузер дає серверу зрозуміти, що “я тебе почув” та надсилає йому у відповідь ACK, теж збільшений на одиничку.</li></ol><p>Таким чином браузер та сервер ручкаються, і всі розуміють, що можна переходити до наступних дій.</p><p>А наступним кроком браузер уже питає сервера по ділу і відправляє йому так званий <strong>HTTP-запит</strong>, в якому детально описує, що він від того сервера хоче. Виглядати він може приблизно так:</p><pre tabindex=0><code>GET / HTTP/1.1
User-Agent: Mozilla/4.0 (compatible; MSIE5.01; Windows NT)
Host: www.rusnipyz.da
Accept-Encoding: gzip, deflate
Connection: Keep-Alive
</code></pre><p>Сильно розбирати я не буду, адже в цьому запиті може бути прямо купа різної інформації, яку туди додає сам браузер, ну і ще криворукі веб-розробники, да. Якщо коротко, то уявіть, що це браузер оформлює запит на отримання чогось, ну, наприклад, довідки про несудимість до того, як її можна стало отримати через “Дію”. Тобто має зібрати всю необхідну інформацію, а то можуть і не видати, а тоді вже сервер то все розбирає і вирішує, шо з тим усім робити.</p><p>Отже, сервер отримує цей запит і починає в ньому розбиратись. У кожного сервера є свої правила обробки запитів, і він уже там, під капотом, розбирається, чи віддавати вам взагалі шось, а якщо да, то шо саме, і тому подібне. І ось коли він розбирається в тому усьому, сервер надсилає вам офіційну відповідь, в якій також міститься купа різної інформації, такої як статус запиту, тип файлу, його вміст і т.д.</p><p>Статус відповіді завжди іде першим рядочком, і містить числовий код, який пояснює браузеру, наскільки успішно все відбулось. Цей код може належати до п’яти категорій:</p><ol><li><strong>Інформаційний код</strong>, <code>1хх</code>. Я отримав запит, працюю над ним, не трогай мене, скоро всьо буде.</li><li><strong>Успішно</strong>, <code>2хх</code>. У мене всьо получилось, забирай.</li><li><strong>Перенаправлення</strong>, <code>3хх</code>. Мужчина, ви шо не бачите, шо ми чай п’єм? Зайдіть в 304-й кабінет, от у них і питайте.</li><li><strong>Помилка клієнта</strong>, <code>4хх</code>. Ти якуто херню запитав, нема нічого.</li><li><strong>Помилка сервера</strong>, <code>5хх</code> Кіт перевернув вазона і у нас не получаєця.</li></ol><p>І уже в залежности від відповіді сервера наш браузер шось показує. Або не показує.</p><h2 id=дерева-дерева-кубікі-всякі>Дерева, дерева, кубікі всякі</h2><p>А далі відбувається та сама чорна магія, про яку, звичайно, варто буде поговорити в окремій статті, але дуже коротенько зачеплю і тут.</p><p>Отже, основа web — це, звичайно ж, html-документи, в яких і описується структура цього документу, як, в якому порядку іде інформація, підказує браузеру наскільки важлива та чи інша частина, що можна з нею зробити і т.д.</p><p><strong>HTML</strong> розшифровується як <strong>HyperText Markup Language</strong>, або ж гіпертекстова мова розмітки. Чому гіпертекстова, чому мова, яка ще розмітка? Це все я детальніше планую описати окремо, а наразі досить зазначити, що це спеціальна мова для розмітки документів, яка полегшує структуризацію даних. Отако. Тож, html-документ — це основа основ, і містить саму інформацію та її структуру. Це інформаційний рівень.</p><p>Ще є <strong>CSS</strong>, <strong>Cascade Style Sheets</strong>, каскадні таблиці стилів, які пояснюють браузеру, наскільки красиво має виглядати документ. За допомогою CSS ми можемо змінювати зовнішній вигляд сторінки — кольори, шрифти, розміри, анімації, оце все. Це — презентаційний рівень.</p><p>І є <strong>JavaScript</strong>, скриптова мова програмування, за допомогою якої можна додавати на сторінку падаючі сніжинки, додавати взаємодію до сторінки, всіляки інтерактивности, також можна створювати штучний інтелект та просто захаращувати оперативну пам’ять вашого пристрою. Це — інтерактивний рівень.</p><p>Сучасна веб-сторінка обов’язково матиме в собі усі ці елементи, але інтернет починався з чистого HTML, і по сей день його одного достатньо, аби браузер був в змозі відобразити вашу інформацію на екрані.</p><p>Спробую максимально просто пояснити процес відображення фінальної картинки. В загальному, щоб мати можливість відобразити вашу сторінку, браузеру потрібно спочатку зрозуміти, що в тому документі взагалі є і яку ж таку структуру ви тим html-ом там описали. Тому він перетворює ваш html-код на певну структуру даних, яку ще називають <em>деревом</em>. З такого дерева він потім складе, ніби з цеглинок, те, як елементи на сторінці повинні розміщуватись, хто за ким стоїть, хто в кому лежить.</p><p>Коли під час побудови цього дерева браузер натикається на посилання на інші ресурси, як то файли CSS, JS, чи медіа, він зазвичай відкладає усі справи в сторону, тобто ставить оце дерево на паузу, вантажить такий ресурс і починає обробляти його.</p><p>Якщо це CSS-файл, то браузер будує інше дерево, в якому теж відбито залежність, каскадність стилів (поки не звертайте не ці терміни уваги, то реально окрема стаття), і, що важливо, щоразу, як вантажиться новий CSS-файл, бідося браузер мусить перебудовувати то довбане дерево наново, бо воно має враховувати всі-всі стилі.</p><p>У випадку з JavaScript браузер виконує увесь код, написаний в ньому, відразу після завантаження, бо це скриптова мова, її не треба компілювати в якийсь двійковий таємничий код перед тим, цим займається сам браузер.</p><p>І от коли ось ця вся катавасія нарешті завершується, браузер збирає докупи всі дерева, щоб почати будувати картинку, що буде відображено у вікні переглядача. Це теж доволі складний процес, бо одне дерево задає порядок і початкове розташування усіх блоків інформації, а інше дерево, те, що робиться з CSS, може вносити корективи в розташування елементів на екрані, тому це дуже громіздко і складно, та в результаті у нього усе вдається, він складає все в прямокутнички, розфарбовує і нарешті на екрані з’являється відображення сторінки. Ура!</p><p>Ось такі от складні процеси відбувають буквально за лічені миті просто для того, аби ми з вами могли помилуватися черговим спаленим танком русні.</p></div></div><div class=footer><div class=footer-social><span class="social-icon social-icon-"><a href=https://t.me/toisamyibabich title target=_blank rel=noopener><img src=/images/telegram-black.svg width=24 height=24 alt></a></span></div></div></main><script type=text/javascript src=/js/bundle.min.5993fcb11c07dea925a3fbd58c03c7f1857197c35fccce3aa963a12c0b3c9960.js></script></body></html>